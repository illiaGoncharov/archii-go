# Стратегия по данным и контенту

## Проблема

Для MVP и масштабирования нужно решить:
1. Откуда брать данные об архитектурных элементах
2. Как упрощать элементы с домов для БД (сохраняя стиль и пропорции)
3. Где находить историческую информацию
4. Как это всё структурировать

---

## Источники данных

### Карты и локации

#### OpenStreetMap (бесплатно, open source)
**Что берём:**
- Координаты зданий
- Адреса
- Годы постройки (если есть теги)
- Архитектурные стили (теги: `building:architecture`, `architect`)

**API:**
```typescript
// Overpass API для поиска зданий
const query = `
  [out:json];
  way["building"]["building:architecture"~"classicism|baroque|modern"]
    (${minLat},${minLon},${maxLat},${maxLon});
  out center;
`;
```

**Преимущества:**
- Бесплатно
- Можно использовать в коммерческих проектах
- Много данных по России

#### 2GIS API (для России)
**Что берём:**
- Детальная информация о зданиях
- Фотографии фасадов (если есть)
- Актуальные адреса

**Ограничения:**
- Нужен API key (бесплатный лимит)

#### Wikimapia
**Что берём:**
- Описания зданий
- Исторические справки
- Пользовательские фото

---

### Архитектурные элементы

#### 1. Википедия / Викисловарь (русский и английский)
**Источники:**
- Статьи о классицизме, барокко, модерне
- Глоссарий архитектурных терминов
- Изображения (многие под CC-BY-SA)

**Пример:**
```
https://ru.wikipedia.org/wiki/Метопа
https://ru.wikipedia.org/wiki/Капитель
https://commons.wikimedia.org/ (фото)
```

#### 2. Архитектурные справочники (открытые)
- "Архитектурный словарь" (общественное достояние)
- "Краткий словарь архитектурных терминов" РАН
- Онлайн-библиотеки архитектурных институтов

#### 3. Музеи и архивы (партнёрства)
**Потенциальные партнёры:**
- Музей архитектуры имени Щусева (Москва)
- Музей истории Петербурга
- ГНИМА (Научно-исследовательский музей архитектуры)
- МосГорАрхив

**Что можно получить:**
- Чертежи элементов
- Исторические справки
- Фотографии деталей
- Экспертизу (проверка описаний)

#### 4. Книги в общественном достоянии
- "Архитектурные ордера" (классика)
- "Архитектурные детали" (дореволюционные издания)
- Сканы старых учебников

#### 5. Flickr / Wikimedia Commons
**Поиск:**
- Тег: "architectural details moscow"
- Лицензия: CC-BY или CC0
- Много фотографий деталей фасадов

---

## Упрощение элементов для БД

### Проблема
Как из фотографии реального элемента сделать упрощённую версию для коллекции, сохранив:
- Узнаваемость
- Стиль
- Пропорции

### Решение: 3 уровня детализации

#### Уровень 1: Референсное фото (хранится отдельно)
**Что:**
- Качественное фото реального элемента
- Используется для AI-классификации (в будущем)
- Показывается в "подробнее о элементе"

**Где брать:**
1. Сам фотографируешь элементы (самый надёжный способ)
2. Wikimedia Commons (CC-BY)
3. Архивы музеев (с разрешением)

#### Уровень 2: Упрощённая иллюстрация (для коллекции)
**Что:**
- Line art, минимализм
- Узнаваемые формы, основные пропорции
- Чистый фон

**Как создавать:**

**Вариант A: Figma (ручной)**
1. Загрузить референсное фото
2. Обвести основные контуры Pen tool
3. Упростить детали (5-10 основных линий)
4. Убрать фон
5. Экспорт PNG 600x600px

**Вариант B: Vectorizer AI + Figma**
1. Загрузить фото в [Vectorizer.ai](https://vectorizer.ai/) (автотрейс)
2. Скачать SVG
3. Открыть в Figma
4. Упростить (убрать мелкие детали)
5. Экспорт PNG

**Вариант C: Midjourney + обработка**
Промпт:
```
architectural element [название], line art illustration, 
minimal details, clean lines, architectural drawing style, 
white background, precise proportions, technical illustration
```
Результат → обработка в Figma (убрать лишнее)

**Вариант D: Stable Diffusion (локально, бесплатно)**
Модель: ControlNet + line art
Промпт: аналогичный Midjourney

#### Уровень 3: Иконка (для карты/меню)
**Что:**
- Совсем упрощённая версия (3-5 линий)
- 32x32px или 48x48px
- Для быстрого распознавания

---

## Процесс наполнения БД

### Этап 1: Базовая коллекция (15-20 элементов)

**Приоритет — частотные элементы:**
1. Метопа, триглиф
2. Сандрик
3. Капитель (дорическая, ионическая, коринфская)
4. Пилястра
5. Руст
6. Розетка
7. Кронштейн/консоль
8. Маскарон
9. Картуш
10. Фестон
11. Волюта
12. Фриз
13. Карниз
14. Наличник
15. Замковый камень

**Источники для описаний:**
- Википедия (базовое описание)
- Architectural Dictionary (детали)
- Твоя редактура (простым языком)

**Время:** 1-2 недели (по 1-2 элемента в день)

### Этап 2: Расширение (50+ элементов)

**Добавить:**
- Редкие элементы (атланты, кариатиды)
- Стилистические вариации (барочная vs классическая капитель)
- Региональные особенности

**Источники:**
- Сканы справочников
- Музейные коллекции
- Пользовательские находки (user-generated)

### Этап 3: Масштабирование

**User-generated content:**
- Пользователи предлагают элементы
- Ты (или модератор) проверяешь и добавляешь
- Gamification: "открой новый элемент — получи бонус"

---

## Структура данных для элемента

```typescript
interface ElementData {
  // Основное
  id: string;
  name: string;
  nameEn?: string;
  
  // Описание
  descriptionShort: string;      // 1-2 предложения (для списка)
  descriptionFull: string;       // Полное описание (для детального просмотра)
  
  // Визуал
  imageSimplified: string;       // Упрощённая иллюстрация (коллекция)
  imageReference: string;        // Референсное фото (детальный просмотр)
  imageIcon?: string;            // Иконка (карта)
  
  // Классификация
  style: Style[];                // ['Классицизм', 'Барокко']
  category: Category;            // 'Декор фасада', 'Ордерные элементы'
  rarity: Rarity;
  
  // История
  origin: string;                // Откуда элемент (Древняя Греция, и т.д.)
  period: string;                // Когда популярен (XVIII-XIX век)
  funFact?: string;              // Интересный факт
  
  // Источники
  sources: {
    text: string;                // Откуда взято описание
    image: string;               // Откуда взято изображение
    license: string;             // CC-BY-SA, Public Domain, etc
  };
  
  // Метаданные
  createdAt: Date;
  updatedAt: Date;
  verified: boolean;             // Проверено экспертом
}
```

---

## Инструменты для разработки

### Обязательные (уже есть)
- Expo Go (тестирование на iPhone)
- Figma (создание иллюстраций)
- Firebase Console (управление данными)

### Рекомендуемые дополнительно

#### 1. Для работы с данными
**Retool / Forest Admin**
- Админка для модерации находок
- CRUD для элементов
- Статистика

**Альтернатива:** Next.js админка (сам сделаешь)

#### 2. Для создания графики
**Vectorizer.ai**
- Автоматическая векторизация фото
- Экспорт в SVG

**Remove.bg**
- Удаление фона с фотографий
- API доступен

**Stable Diffusion (локально)**
- Генерация вариаций элементов
- ControlNet для line art

#### 3. Для AI-классификации (будущее)
**Teachable Machine (Google)**
- Простое обучение модели
- Экспорт для TensorFlow Lite

**Clarifai / Google Vision API**
- Готовые модели
- Custom training

#### 4. Для контента
**Notion / Airtable**
- База знаний об элементах
- Источники, справки, todo
- Можно экспортировать в JSON → Firestore

**ChatGPT / Claude**
- Помощь в написании описаний
- Проверка фактов
- Идеи для fun facts

---

## Монетизация

### Фаза 1: Бесплатная база (валидация)

**Бесплатно всё:**
- Все элементы
- Все функции
- Нет рекламы

**Цель:**
- Набрать 100-500 пользователей
- Получить фидбек
- Понять, что зашло

### Фаза 2: Freemium (после 1000+ пользователей)

#### Бесплатно:
- Базовая коллекция (30 элементов)
- Карта с POI
- Камера
- Простой конструктор

#### Premium ($2.99/месяц или $24.99/год):
- **Полная коллекция** (100+ элементов)
- **Эксклюзивные элементы** (редкие, исторические)
- **Расширенный конструктор** (экспорт в высоком качестве)
- **Авторские маршруты** от архитекторов
- **Без рекламы** (если добавим)
- **Ранний доступ** к новым функциям

#### Pro ($9.99/месяц):
- Всё из Premium
- **AI-классификация** (автоматическая)
- **Экспорт коллекции** (PDF, презентация)
- **Создание своих маршрутов** (для гидов)
- **Аналитика** (где находишь больше всего)

### Фаза 3: Дополнительные источники дохода

#### 1. Коллаборации с музеями
**Модель:**
- Музей создаёт эксклюзивный маршрут
- Пользователи проходят → получают сертификат
- Музей платит за размещение / revenue share

**Примеры:**
- "Классицизм на Тверской" (от Музея архитектуры)
- "Модерн на Арбате" (от Музея Москвы)

#### 2. Образовательные курсы
**Модель:**
- Курс "Архитектурная азбука" (10 уроков × $4.99)
- Интеграция с находками: "найди эти 5 элементов"
- Сертификат после прохождения

**Партнёры:**
- Архитектурные школы (МАРХИ, МАРШ)
- Курсы Coursera / Stepik

#### 3. Туристические агентства
**Модель:**
- White label: брендированное приложение для тургруппы
- Готовые маршруты для туров
- Фиксированная плата за лицензию

#### 4. In-app purchases
**Что продавать:**
- "Набор элементов Барокко" ($1.99)
- "Редкий элемент недели" ($0.99)
- "Эксклюзивный маршрут" ($2.99)
- "Дополнительные слоты для фасадов" ($1.99)

#### 5. Мерч (масштаб)
**Печать на заказ:**
- Постеры с коллекцией элементов
- Магниты с найденными элементами
- Футболки с архитектурными паттернами

**Платформа:** Printful / Redbubble (печать и доставка)

#### 6. Корпоративные лицензии
**Для кого:**
- Архитектурные бюро (обучение стажёров)
- Университеты (для студентов)
- Школы (факультативы)

**Модель:**
- $99-499/год за организацию
- Брендирование, свои маршруты

#### 7. Спонсорство POI
**Модель:**
- Кафе/бар рядом с POI → спонсирует точку
- "Точка интереса спонсируется кафе XYZ"
- Ненавязчиво, по теме (архитектурные места)

### Ожидаемая выручка (прогноз)

**Через 1 год (оптимистично):**
- 10,000 пользователей
- 5% конверсия в Premium → 500 платящих
- $2.99/месяц × 500 = **$1,495/месяц** (~$18k/год)

**Через 2 года:**
- 50,000 пользователей
- 3-5% конверсия → 1,500-2,500 платящих
- + коллаборации с музеями → +$5-10k/год
- Итого: **$50-80k/год**

---

## Roadmap по контенту

### Месяц 1-2: MVP контент
- [ ] 15 базовых элементов (вручную)
- [ ] 5 POI в Москве
- [ ] Описания из Википедии + редактура
- [ ] Упрощённые иллюстрации в Figma

### Месяц 3-4: Расширение
- [ ] 30 элементов
- [ ] 15 POI (3 района Москвы)
- [ ] Партнёрство с 1 музеем (тестовое)
- [ ] Пользовательские предложения (beta)

### Месяц 5-6: Автоматизация
- [ ] AI-классификация (базовая)
- [ ] Админка для модерации
- [ ] User-generated POI
- [ ] 50+ элементов

### Год 1: Масштабирование
- [ ] 100+ элементов
- [ ] 50+ POI
- [ ] 3-5 городов (Москва, Питер, Казань, Нижний, Екб)
- [ ] Коллаборации с музеями
- [ ] Freemium модель

---

## Приоритеты сейчас

### Для MVP (следующие 2 недели):
1. **Создать 15 иллюстраций элементов**
   - Начни с простых (метопа, руст, пилястра)
   - Figma + line art стиль
   - Референсы из Wikimedia Commons

2. **Написать описания**
   - Короткое (1-2 предложения)
   - Полное (1-2 абзаца)
   - Fun fact (опционально)
   - Источник: Википедия + твоя редактура

3. **Заполнить Firebase**
   - Загрузить иллюстрации в Storage
   - Обновить imageUrl в Firestore
   - Добавить описания

4. **Пройти прогулку**
   - Протестировать на реальном iPhone
   - Сфотографировать элементы
   - Собрать фидбек

### Для масштабирования (месяцы 2-6):
1. Автоматизация создания иллюстраций (AI)
2. Партнёрство с музеями
3. User-generated content
4. Freemium модель

---

---

## Верификация находок

### Проблема

Как убедиться, что пользователь действительно нашёл нужный элемент, а не сфотографировал:
- Что-то похожее, но не то
- Случайную текстуру
- Фото из интернета
- Элемент в другом городе (для статистики важно знать где)

### Решение: Многоуровневая верификация

#### Уровень 1: Базовая проверка (автоматически)

**Геолокация:**
```typescript
// Проверяем, что фото сделано рядом с POI или в активной зоне города
const distance = calculateDistance(
  photo.location,
  nearestPOI.location
);

// Если больше 50м от POI — попросить подтвердить адрес
if (distance > 50 && !user.isExplorer) {
  showAddressConfirmation();
}
```

**Время:**
- Проверяем timestamp фото
- Если фото старое (>1 месяц) — помечаем "архивная находка"
- Ночные фото (22:00-6:00) — дополнительная проверка

**EXIF данные:**
- Координаты из EXIF (если есть)
- Модель камеры (скриншот vs реальное фото)
- Timestamp

#### Уровень 2: AI-классификация (средний срок)

**Модель на базе TensorFlow Lite:**
```typescript
// Классифицирует элемент по фото
const result = await classifyElement(photo);

// Если уверенность >70% — автоматически принимаем
if (result.confidence > 0.7) {
  acceptFinding(result.elementId);
}

// Если 40-70% — просим пользователя выбрать
if (result.confidence > 0.4) {
  showElementOptions([result.top3]);
}

// Если <40% — отправляем на модерацию
if (result.confidence < 0.4) {
  sendToModeration(photo);
}
```

**Обучение модели:**
1. Собираем датасет из верифицированных находок
2. Дообучаем модель на реальных фото пользователей
3. Улучшаем со временем (supervised learning)

#### Уровень 3: Модерация сообществом (долгий срок)

**Peer review:**
- Пользователи с уровнем >10 могут верифицировать находки других
- За правильную верификацию — бонусные очки
- За ошибочную — штраф

**Expert review:**
- Партнёры (музеи, архитекторы) верифицируют редкие находки
- Получают доступ к статистике за это

#### Уровень 4: Умная статистика

**Проверка аномалий:**
```typescript
// Если пользователь нашёл 50 "редких" элементов за час — подозрительно
if (user.findingsLastHour > 50 && user.rareFindings > 40) {
  flagForReview(user);
}

// Если элемент найден в неожиданном месте
if (!element.cities.includes(finding.city)) {
  // "Атлант" в Берлине — редкость, дополнительная проверка
  sendToExpertReview(finding);
}
```

---

## Географическое расширение

### Концепция "Исследователей"

**Бонусы за находки в новых городах:**

```typescript
interface CityStatus {
  name: string;
  status: 'established' | 'emerging' | 'unexplored';
  totalFindings: number;
  activeUsers: number;
}

// Москва — established (1000+ находок)
// Казань — emerging (100-999 находок)
// Феррара — unexplored (<100 находок)

const calculatePoints = (element, city) => {
  const basePoints = element.basePoints;
  
  if (city.status === 'unexplored') {
    return basePoints * 2; // Удвоенные очки
  }
  
  if (city.status === 'emerging') {
    return basePoints * 1.5; // +50%
  }
  
  return basePoints;
};
```

**Статус "Пионер":**
- Первые 10 пользователей в новом городе
- Бейдж "Explorer"
- Особые награды

### Процесс добавления нового города

#### Фаза 1: User-generated (минимум усилий)

Пользователь запрашивает город:
1. Отправляет форму: "Хочу добавить Феррару"
2. Указывает 3-5 потенциальных POI
3. Делает первые находки

**Что происходит:**
- Город добавляется со статусом "unexplored"
- Все находки проходят модерацию
- Удвоенные очки за находки

#### Фаза 2: Куратор города (средние усилия)

Находим локального куратора:
- Архитектор
- Гид
- Увлечённый пользователь

**Задачи куратора:**
- Добавить 10-15 POI
- Написать описания
- Модерировать первые находки
- Проверить соответствие элементов

**Мотивация:**
- Имя в приложении ("Куратор Феррары")
- Премиум доступ бесплатно
- Процент от премиум подписок в городе (5%)

#### Фаза 3: Официальное добавление (большие усилия)

Когда город набирает 50+ находок:
- Создаём базу элементов для региона
- Добавляем уникальные стили (итальянский готик и т.д.)
- Партнёрство с местными музеями
- Переводы (для не-русских городов)

### Приоритеты городов для расширения

**Tier 1 (ближайшие 6 месяцев):**
- Москва ✅
- Санкт-Петербург
- Казань

**Tier 2 (год 1):**
- Нижний Новгород
- Екатеринбург
- Ростов-на-Дону
- Владимир/Суздаль

**Tier 3 (год 2, если есть тяга):**
- Прибалтика (Таллин, Рига)
- Восточная Европа (Варшава, Прага)
- Италия (Феррара, Болонья, Венеция)
- Германия (Берлин, Дрезден)

**Критерии приоритета:**
1. Русскоязычная аудитория (проще маркетинг)
2. Богатая архитектура
3. Туристический потенциал
4. Наличие местных кураторов

---

## Верификация в новых городах

### Проблема

В Ферраре могут быть элементы, которых нет в базе. Как это обрабатывать?

### Решение: "Полевой режим"

**Когда пользователь в unexplored городе:**

```typescript
// Приложение переключается в "Explorer Mode"
if (city.status === 'unexplored') {
  enableExplorerMode();
}
```

**Что меняется:**

1. **Свободная классификация:**
   - Можно выбрать элемент из базы
   - Можно предложить новый ("Похоже на капитель, но другой стиль")
   - Можно оставить без категории ("Неизвестный декор")

2. **Обязательное описание:**
   - Где нашёл (адрес)
   - Что это, по твоему мнению
   - Эпоха/стиль (если знаешь)

3. **Все находки на модерации:**
   - Проверяет куратор или эксперт
   - Если элемент новый — добавляют в базу
   - Если ошибка — помечают + обучение

4. **Удвоенные очки:**
   - За риск (может быть неверно)
   - За вклад в базу знаний

### Статистика по городам

**Dashboard для кураторов:**
```
Феррара
- Находок: 47
- Пользователей: 8
- Элементов найдено: 12 уникальных
- Точность: 78% (верифицировано)
- Топ элементы: Маскарон (15), Руст (12), Капитель (8)
```

**Геймификация:**
- Бейдж "Первопроходец Феррары"
- Таблица лидеров по городам
- Ачивка "5 городов"

---

## AI-верификация: Как это работает

### Подход

**Не "чёрный ящик", а прозрачный алгоритм:**

1. **Распознавание объекта:**
   - Где на фото элемент
   - Его границы (bounding box)

2. **Извлечение признаков:**
   - Форма (геометрия)
   - Пропорции
   - Паттерны (повторяющиеся детали)

3. **Сравнение с базой:**
   - Ищем похожие элементы
   - Учитываем стиль здания
   - Учитываем геолокацию (в Москве вряд ли барокко)

4. **Оценка уверенности:**
   - >80% — "Точно метопа"
   - 60-80% — "Похоже на метопу"
   - <60% — "Неуверен, проверь сам"

### Обучение модели

**Датасет:**
- Верифицированные находки пользователей
- Wikimedia Commons (размеченные)
- Фото из музейных каталогов

**Архитектура:**
- MobileNet (быстро на телефоне)
- EfficientNet (точнее, но медленнее)
- Custom CNN (дообучаем под архитектурные детали)

**Continuous learning:**
- Каждая верифицированная находка улучшает модель
- Раз в месяц — переобучение
- A/B тестирование версий

---

## Приоритеты реализации

### MVP (сейчас):
- ✅ Базовая геолокация
- ✅ EXIF проверка
- ✅ Timestamp
- ⬜ Простейшая модерация (ты вручную проверяешь)

### Фаза 2 (месяц 3-6):
- ⬜ AI-классификация (базовая)
- ⬜ Автоматическая верификация простых элементов
- ⬜ Explorer Mode для новых городов
- ⬜ Первый куратор (Питер)

### Фаза 3 (месяц 6-12):
- ⬜ Peer review (модерация сообществом)
- ⬜ Улучшенная AI (высокая точность)
- ⬜ 5+ городов
- ⬜ Expert partnerships

---

## Технические детали верификации

### Структура данных для находки

```typescript
interface Finding {
  id: string;
  userId: string;
  elementId: string;
  
  // Фото
  photoUrl: string;
  photoMetadata: {
    timestamp: Date;
    location: GeoPoint;
    exif: {
      camera?: string;
      gps?: GeoPoint;
      takenAt?: Date;
    };
  };
  
  // Локация
  location: GeoPoint;
  address?: string;
  city: string;
  cityStatus: 'established' | 'emerging' | 'unexplored';
  nearestPOI?: string; // ID ближайшего POI
  distanceFromPOI?: number; // в метрах
  
  // Верификация
  verificationStatus: 'pending' | 'auto_approved' | 'manual_approved' | 'rejected';
  verificationMethod: 'auto' | 'ai' | 'peer' | 'expert';
  aiConfidence?: number; // 0-1
  verifiedBy?: string; // userId модератора
  verifiedAt?: Date;
  
  // Очки
  basePoints: number;
  bonusMultiplier: number; // 1x, 1.5x, 2x (для новых городов)
  totalPoints: number;
  
  // Флаги
  isExplorerMode: boolean; // Находка в unexplored городе
  isSuspicious: boolean; // Помечено для проверки
  isFirstInCity: boolean; // Первая находка этого элемента в городе
  
  createdAt: Date;
}
```

### API endpoints

```typescript
// Создать находку
POST /api/findings
{
  elementId: string;
  photo: File;
  location: GeoPoint;
  comment?: string;
}

// Ответ:
{
  findingId: string;
  verificationStatus: 'pending' | 'approved';
  points: number;
  multiplier: number;
  message: string; // "Отличная находка! +20 очков (×2 за редкость в Ферраре)"
}

// Получить находки на модерации (для кураторов)
GET /api/moderation/pending?city=ferrara

// Верифицировать находку
POST /api/moderation/verify/:findingId
{
  approved: boolean;
  correctElementId?: string; // Если ошибся
  comment?: string;
}
```

---

**Итого по верификации:**
- Геолокация + EXIF (MVP)
- AI-классификация (фаза 2)
- Peer review (фаза 3)
- Explorer Mode для новых городов (×2 очки)
- Кураторы городов (партнёрство)

**Итого по данным:**
- Википедия + Wikimedia Commons + музеи + сам фотографируешь
- Упрощение: Figma + line art (потом AI)
- Монетизация: Freemium + коллаборации + курсы + in-app purchases

**Следующий шаг:** Создать первые 5 иллюстраций элементов в Figma.

