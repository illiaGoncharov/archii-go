# Экран авторизации ArchiGo

## Описание

Реализован полнофункциональный экран авторизации для приложения ArchiGo с поддержкой:
- Email/password входа и регистрации
- Анонимного входа
- Валидации полей
- Обработки ошибок Firebase

## Структура файлов

### Созданные файлы

1. **app/auth.tsx** - Основной экран авторизации
   - Два режима: вход и регистрация (переключение через табы)
   - Поля: имя (для регистрации), email, пароль, подтверждение пароля
   - Валидация в реальном времени
   - Обработка ошибок Firebase с русскими сообщениями
   - Кнопки: основная кнопка входа/регистрации, кнопка анонимного входа
   - Ссылка "Забыл пароль" (пока показывает Alert)

### Обновленные файлы

2. **services/auth.ts**
   - Добавлен импорт `signInAnonymously` из Firebase Auth
   - Добавлена функция `signInAnonymously()` для анонимного входа

3. **app/_layout.tsx**
   - Добавлен экран `auth` в Stack навигацию

4. **app/index.tsx**
   - Реализована проверка авторизации при запуске
   - Перенаправление на `/auth` если пользователь не авторизован
   - Перенаправление на `/(tabs)` если пользователь авторизован

## Функциональность

### Режимы работы

#### Вход (Sign In)
- Поля: Email, Пароль
- Кнопки: "Войти", "Войти анонимно"
- Ссылка: "Забыл пароль"

#### Регистрация (Sign Up)
- Поля: Имя, Email, Пароль, Подтверждение пароля
- Кнопки: "Зарегистрироваться", "Войти анонимно"

### Валидация

- **Email**: проверка формата (regex)
- **Пароль**: минимум 6 символов
- **Подтверждение пароля**: совпадение с основным паролем
- **Имя**: обязательное для заполнения

Ошибки отображаются красным текстом под соответствующими полями.

### Обработка ошибок Firebase

Локализованные сообщения для всех основных ошибок:
- `auth/user-not-found` → "Пользователь не найден"
- `auth/wrong-password` → "Неверный пароль"
- `auth/email-already-in-use` → "Email уже используется"
- `auth/weak-password` → "Пароль слишком простой"
- `auth/invalid-email` → "Неверный формат email"
- `auth/too-many-requests` → "Слишком много попыток. Попробуйте позже"
- `auth/network-request-failed` → "Ошибка сети. Проверьте подключение"
- Прочие → "Произошла ошибка. Попробуйте позже"

### Дизайн

Экран следует дизайн-системе приложения (constants/design.ts):
- Цвета: `Colors` (primary, background, surface, error, etc.)
- Типографика: `Typography` (h1, body, button, caption)
- Отступы: `Spacing` (xs, sm, md, base, lg, xl, xxl, xxxl)
- Скругления: `BorderRadius` (md)

**Layout**:
- SafeAreaView для безопасных областей
- KeyboardAvoidingView для корректной работы с клавиатурой на iOS
- ScrollView для поддержки маленьких экранов

**UI элементы**:
- Переключатель режима в виде двух кнопок-табов
- Поля ввода с border и подсветкой ошибок
- Основная кнопка с ActivityIndicator при загрузке
- Вторичная кнопка для анонимного входа

## Навигация

После успешной авторизации:
- Обновляется `userStore` через `setUser(user)`
- Происходит переход на главный экран: `router.replace('/(tabs)')`

При запуске приложения (app/index.tsx):
- Проверяется текущий пользователь
- Если авторизован → `/(tabs)`
- Если нет → `/auth`

## Использование

### Для входа
1. Выберите режим "Вход"
2. Введите email и пароль
3. Нажмите "Войти"

### Для регистрации
1. Выберите режим "Регистрация"
2. Введите имя, email, пароль и подтверждение
3. Нажмите "Зарегистрироваться"

### Для быстрого тестирования
1. Нажмите "Войти анонимно" в любом режиме
2. Пользователь будет создан как "Гость"

## Технические детали

### TypeScript
Все типы строго проверены (strict mode):
- Используется `FirebaseError` для типизации ошибок
- Типы для режима: `type AuthMode = 'signin' | 'signup'`
- Интерфейс ошибок для всех полей

### State Management
- Локальное состояние (useState) для формы и UI
- Zustand store (`userStore`) для глобального состояния пользователя

### Firebase Integration
- Firebase Auth для авторизации
- Firestore для хранения профилей пользователей
- Анонимный вход создает временного пользователя без записи в Firestore

## Возможные улучшения

1. Реализация восстановления пароля (sendPasswordResetEmail)
2. Добавление OAuth провайдеров (Google, Apple)
3. Добавление кнопки показа/скрытия пароля
4. Автоматическая проверка email при регистрации
5. Сохранение учетных данных для автоматического входа
6. Биометрическая аутентификация
