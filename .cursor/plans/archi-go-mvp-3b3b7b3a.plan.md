<!-- 3b3b7b3a-f216-4e85-861b-fee005a5ca6c e214f1c5-e2c2-4f69-944e-7af9da5dd4e4 -->
# План разработки Archi-Go MVP

## Технологический стек

### Мобильное приложение

- **Framework**: Expo (React Native) с TypeScript
- **Навигация**: expo-router или react-navigation
- **Состояние**: Zustand (как в текущем стиле проекта)
- **Карты**: react-native-maps
- **Камера**: expo-camera
- **Геолокация**: expo-location
- **Конструктор**: react-native-svg или Skia

### Бэкенд

- **Auth**: Firebase Authentication
- **База данных**: Firebase Firestore
- **Хранилище**: Firebase Storage
- **Функции**: Firebase Cloud Functions (для классификации)

### Альтернатива для быстрого старта

- Сначала можно сделать **ручную классификацию** (модератор проверяет фото)
- Позже подключить AI (TensorFlow Lite, Teachable Machine или сторонний API типа Clarifai/Google Vision)

---

## Структура данных (Firestore)

### Коллекция `users`

```typescript
{
  id: string,
  email: string,
  displayName: string,
  level: number,
  totalPoints: number,
  createdAt: timestamp
}
```

### Коллекция `elements`

```typescript
{
  id: string,
  name: string,              // "Метопа", "Сандрик", "Капитель"
  description: string,        // Описание элемента
  style: string,             // "Барокко", "Классицизм", "Модерн"
  rarity: 'common' | 'rare' | 'epic' | 'legendary',
  points: number,            // Очки за находку
  imageUrl: string,          // Эталонное изображение
  totalFound: number         // Сколько раз найден всеми юзерами
}
```

### Коллекция `findings`

```typescript
{
  id: string,
  userId: string,
  elementId: string,
  photoUrl: string,          // Фото пользователя
  location: GeoPoint,
  address: string,
  status: 'pending' | 'approved' | 'rejected',
  createdAt: timestamp
}
```

### Коллекция `poi` (Points of Interest)

```typescript
{
  id: string,
  title: string,
  description: string,
  location: GeoPoint,
  elementsNearby: string[],  // ID элементов
  difficulty: 'easy' | 'medium' | 'hard'
}
```

### Коллекция `facades` (пользовательские фасады)

```typescript
{
  id: string,
  userId: string,
  title: string,
  elementsUsed: Array<{
    elementId: string,
    x: number,
    y: number,
    scale: number
  }>,
  likes: number,
  createdAt: timestamp
}
```

---

## Архитектура приложения

### Структура папок (Expo)

```
archi-go/
├── app/                    # Expo Router (навигация)
│   ├── (tabs)/
│   │   ├── map.tsx        # Экран карты
│   │   ├── camera.tsx     # Экран камеры
│   │   ├── collection.tsx # Коллекция
│   │   └── profile.tsx    # Профиль
│   ├── builder.tsx        # Конструктор фасадов
│   └── _layout.tsx
├── components/
│   ├── map/
│   │   ├── MapView.tsx
│   │   └── POIMarker.tsx
│   ├── camera/
│   │   ├── CameraView.tsx
│   │   └── PhotoPreview.tsx
│   ├── collection/
│   │   ├── ElementCard.tsx
│   │   ├── ElementGrid.tsx
│   │   └── ElementDetail.tsx
│   └── builder/
│       ├── FacadeCanvas.tsx
│       ├── ElementPalette.tsx
│       └── ElementTile.tsx
├── services/
│   ├── firebase.ts        # Firebase config
│   ├── auth.ts            # Авторизация
│   ├── firestore.ts       # CRUD операции
│   └── storage.ts         # Загрузка фото
├── stores/
│   ├── userStore.ts       # Zustand store для юзера
│   ├── collectionStore.ts # Коллекция элементов
│   └── cameraStore.ts     # Состояние камеры
├── types/
│   ├── element.ts
│   ├── finding.ts
│   └── user.ts
└── utils/
    ├── geolocation.ts
    ├── rarity.ts          # Расчёт редкости
    └── points.ts          # Расчёт очков
```

---

## Основные экраны MVP

### 1. Карта (Map)

- Показывает текущую позицию пользователя
- Отмечает Points of Interest (POI) — места с архитектурными элементами
- При клике на POI показывает информацию + кнопку "Идти туда"
- Фиксированные точки для MVP (5-10 в одном районе)

**Компоненты:**

- `MapView` — обёртка над `react-native-maps`
- `POIMarker` — кастомный маркер с иконкой
- `CurrentLocation` — маркер текущего местоположения

### 2. Камера (Camera)

- Открывает нативную камеру
- Делает снимок архитектурного элемента
- После снимка:
  - Показывает превью
  - Запрашивает подтверждение
  - Сохраняет фото в Firebase Storage
  - Создаёт запись в `findings` со статусом `pending`
- **Для MVP**: модератор вручную проверяет и присваивает `elementId`
- **В будущем**: автоматическая классификация через AI

**Компоненты:**

- `CameraView` — обёртка над `expo-camera`
- `PhotoPreview` — показ фото перед отправкой
- `SubmitButton` — отправка находки

### 3. Коллекция (Collection)

- Показывает все архитектурные элементы (карточки)
- Элементы, которые пользователь уже нашёл, — цветные и доступны
- Элементы, которые ещё не найдены, — в тени/замочке
- При клике на элемент — показывается детальная информация:
  - Название
  - Описание
  - Стиль
  - Редкость
  - Где и когда найден (если найден)
  - Сколько раз найден другими пользователями

**Компоненты:**

- `ElementGrid` — сетка элементов
- `ElementCard` — карточка элемента
- `ElementDetail` — модальное окно с деталями

### 4. Конструктор фасадов (Builder)

- 2D-холст (сетка) для размещения элементов
- Палитра элементов из твоей коллекции
- Перетаскивание элементов на холст (drag-and-drop)
- Масштабирование, поворот элементов
- Сохранение фасада
- Возможность поделиться (скриншот или ссылка)

**Компоненты:**

- `FacadeCanvas` — холст (react-native-svg или Skia)
- `ElementPalette` — список доступных элементов
- `ElementTile` — перетаскиваемый элемент
- `SaveButton` — сохранение фасада

### 5. Профиль (Profile)

- Информация о пользователе
- Уровень, очки
- Статистика: сколько элементов найдено, редчайший элемент
- Список созданных фасадов
- Выход

---

## MVP функциональность (минимум)

1. **Авторизация** (email/password или анонимная для начала)
2. **Карта** с 5-10 фиксированными POI в одном районе (например, Петроградка)
3. **Камера** для съёмки элементов + загрузка фото
4. **Ручная модерация** находок (админ через Firebase Console или простая админка)
5. **Коллекция** из 15-20 базовых элементов (метопа, сандрик, капитель, розетка и т.д.)
6. **Простой конструктор** фасада: холст + палитра + сохранение локально/в облако
7. **Базовая геймификация**: очки, редкость, "новый элемент разблокирован!"

---

## Поэтапная разработка

### Этап 1: Инициализация и структура (1-2 дня)

- Создать Expo проект с TypeScript
- Настроить Expo Router (навигация по экранам)
- Настроить Firebase (Auth, Firestore, Storage)
- Создать базовую структуру папок
- Настроить Zustand stores

### Этап 2: Карта и POI (2-3 дня)

- Интеграция react-native-maps
- Получение текущей геолокации
- Отображение фиксированных POI на карте
- Модальное окно с информацией о POI

### Этап 3: Камера и загрузка фото (2-3 дня)

- Интеграция expo-camera
- UI для съёмки фото
- Превью фото перед отправкой
- Загрузка в Firebase Storage
- Создание записи `findings` в Firestore

### Этап 4: Коллекция элементов (2-3 дня)

- Заполнить Firestore базой из 15-20 элементов (вручную)
- Компонент сетки элементов
- Компонент карточки элемента
- Детальный просмотр элемента
- Логика "найден / не найден"

### Этап 5: Конструктор фасада (3-4 дня)

- Холст на react-native-svg
- Палитра элементов из коллекции
- Drag-and-drop элементов
- Сохранение фасада в Firestore
- Возможность поделиться (скриншот)

### Этап 6: Профиль и геймификация (1-2 дня)

- Экран профиля
- Расчёт уровня и очков
- Статистика находок
- Список фасадов пользователя

### Этап 7: Тестирование и полировка (2-3 дня)

- Тестирование на реальном iPhone
- Прогулка по городу с приложением
- Фиксация багов и UX-проблем
- Добавление анимаций, звуков (опционально)
- Улучшение UI/UX

---

## Что нужно для запуска

1. **Аккаунт Firebase** (бесплатный план подойдёт для MVP)
2. **Expo Go** на iPhone (бесплатное приложение из App Store)
3. **Базовая коллекция элементов**: названия, описания, картинки (15-20 элементов)
4. **Тестовый район**: выбрать район, пройти по нему, сфотографировать элементы, создать 5-10 POI

---

## Расширение после MVP

### Автоматическая классификация

- Обучить модель на фотографиях элементов
- TensorFlow Lite в приложении (офлайн)
- Или API классификации (Google Vision, Clarifai, кастомная модель)

### Пользовательские маршруты

- Юзеры могут создавать свои маршруты
- "Пройди эту экскурсию и собери все элементы модерна"

### Социальные функции

- Лента находок друзей
- Лайки и комментарии к фасадам
- Рейтинг игроков

### Коллаборации

- Партнёрство с музеями, архитектурными школами
- Уникальные задания и элементы
- Авторские гиды от архитекторов

### Монетизация

- Премиум-подписка: эксклюзивные элементы, стили, экскурсии
- In-app purchases: "набор элементов барокко", "редкие элементы"
- Партнёрский контент: брендированные туры от музеев
- Реклама (ненавязчивая)

### Расширение географии

- После успеха в одном городе — добавить другие города
- Локализация на другие языки

---

## Риски и как их решать

**Риск 1: Плохая классификация элементов вручную**

- Решение: Начать с простых элементов, которые легко узнать
- Сделать обучающий гайд для модераторов
- Позже подключить AI

**Риск 2: Мало контента (элементов)**

- Решение: Начать с одного стиля (например, классицизм)
- Пригласить друзей-архитекторов помочь с описаниями
- Постепенно расширять базу

**Риск 3: Скучно искать элементы**

- Решение: Геймификация (уровни, редкость, достижения)
- Интересные описания элементов (история, факты)
- Конструктор как креативный инструмент

**Риск 4: Сложно тестировать**

- Решение: Expo Go позволяет мгновенно тестировать на айфоне
- Можно быстро итерироваться

---

## Итого по MVP

**Минимальный набор для первого теста:**

1. Expo приложение с 4 экранами (карта, камера, коллекция, профиль)
2. Firebase для авторизации, данных, хранения фото
3. 15-20 архитектурных элементов в базе
4. 5-10 POI в одном районе
5. Ручная модерация находок (пока без AI)
6. Простой конструктор фасада (2D)
7. Базовая геймификация (очки, редкость)

**Время разработки: 2-3 недели** (если работать регулярно)

**Следующий шаг после плана:**

- Создать структуру проекта
- Настроить Firebase
- Начать с карты или камеры (что интереснее)

### To-dos

- [ ] Инициализировать Expo проект с TypeScript, настроить Expo Router и базовую структуру
- [ ] Создать Firebase проект, настроить Auth, Firestore, Storage, добавить конфиг в приложение
- [ ] Настроить Zustand stores (userStore, collectionStore, cameraStore) с типизацией
- [ ] Реализовать экран карты с react-native-maps, геолокацией и отображением POI
- [ ] Реализовать экран камеры с expo-camera, превью и загрузкой фото в Firebase Storage
- [ ] Реализовать экран коллекции с сеткой элементов, карточками и детальным просмотром
- [ ] Реализовать конструктор фасадов с холстом, палитрой элементов и сохранением
- [ ] Реализовать экран профиля с статистикой, уровнем, очками и списком фасадов
- [ ] Заполнить Firestore базовой коллекцией элементов (15-20) и POI (5-10)
- [ ] Протестировать приложение на реальном iPhone, пройти по городу, собрать фидбек